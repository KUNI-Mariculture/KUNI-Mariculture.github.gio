---
title: "Mariculture"
output:
  html_document:
    theme: united
    highlight: tango
    runtime: shiny
---

##Mapping mariculture variables 2011

<iframe src="https://faundez.shinyapps.io/maps/" style="border: black; width: 1500px; height: 700px"></iframe> 

```{r, echo=FALSE, warning=FALSE,message=F}


WD<-getwd()

suppressPackageStartupMessages({
  library(readr)
  library(knitr)
  library(shiny)
  library(googleVis)
})

data1 <- read.csv('maps/data/data_normalized_092616.csv')
data2 <- read.csv('maps/data/CountryConversion.csv')
data3 <- merge(x = data1, y=data2, by.x = c("country"), by.y=c("FAO_Country"))

vars <- names(data3)[4:24]
names(vars) <- c("Trade Balance (Q)","Trade Balance (V)", "Energy Adequacy","GDP","Fatty Acids","Calories","Protein",
                 "Vitamin A","Thiamin","Niacin","Riboflavin","B6","Iron","Calcium","Zinc","Native","Fishmeal","Habitat",
                 "Species Farmed","Production Ratio","All Vitamins")
```

```{r echo = FALSE}
require(shiny)

shinyApp(

  ui <- shinyUI(fluidPage(

  # Application title
    titlePanel(
      textOutput(outputId = "title")
      ),
  
  # Choose variable
    selectInput("var",label="Choose Variable",choices=vars),

  # Show a plot of the generated distribution
    mainPanel(
      htmlOutput(outputId = "gvis")
    )
  )),


  server <- shinyServer(function(input, output) {
    
    # Get appropriate reactive input
    rv <- reactiveValues()
    #variable name
    getvar <- reactive({rv$v <- input$var[1]})
    
    #data
    getdat <- reactive({rv$dat <- data3[!is.na(data3[,input$var[1]]),]})
    
    output$title <- renderText(names(vars)[match(getvar(),vars)])
  
    output$gvis=renderGvis({
      
      getvar()
      
      getdat()
  
      temp <- data.frame(data = rv$dat[,rv$v], FAO_Country = rv$dat[,"country"])
      # Plot countries
      Sys.sleep(0.3)
  
      gvisGeoChart(temp, "FAO_Country", "data", hovervar="FAO_Country",
                   options=list(colorAxis="{colors:['#FFFFFF', '#0000FF']}"))
    })
  }),

 options = list(height = 500)
)
```


```{r echo = FALSE, message=FALSE}

# data1 <- read.csv('maps/data/data_normalized_092616.csv')
# data2 <- read.csv('maps/data/CountryConversion.csv')
# data3 <- merge(x = data1, y=data2, by.x = c("country"), by.y=c("FAO_Country"))
# data3 <- data3[!is.na(data3$gdp),]
# 
# #gdp
# gdp <- data3$gdp
# FAO_Country <- data3$country


```
