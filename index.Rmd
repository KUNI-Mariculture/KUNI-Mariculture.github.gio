---
title: "Mariculture"
output:
  html_document:
    theme: united
    highlight: tango
---

##Maping mariculture variables

```{r, echo=FALSE, warning=FALSE}

setwd("~/KUNI/KUNI-Mariculture.github.io")

suppressPackageStartupMessages({
  library(readr)
  library(dplyr)
  library(tidyr)
  library(ggplot2)
  library(knitr)
  library(shiny)
  library(googleVis)

})

```

```{r echo = FALSE}


mapa <- function(data1, data2){
  require(shiny)
  
shinyApp(
  
  ui <- shinyUI(fluidPage(
  
  # Application title
  titlePanel("Mariculture 2011"),
  
  # Show a plot of the generated distribution
  mainPanel(
    htmlOutput("gvis")
  )
)),


server <- shinyServer(function(input, output) {
  
  output$gvis=renderGvis({
    ##### MARICULTURE VARIABLES STARTS HERE
    ## Prepare data to be displayed
    #reading data
    
    #x <- read_csv('maps/data/data_normalized_092616.csv')
     x <- data1
    #This is the file with the matching column "FAO_Country"
    
    #conversion <- read_csv('maps/data/CountryConversion.csv')
    conversion <- data2
    gdp <- x %>% 
      filter(!is.na(gdp)) %>%
      rename(FAO_Country=country) %>%        #rename match column FAO_Country
      left_join(                             #joining harvest_countries with conversion data 
        conversion, 
        by = c("FAO_Country")) %>%
      select(FAO_Country, gdp) 
    
    # Plot countries
    
    gvisGeoChart(gdp, "FAO_Country", "gdp", hovervar="FAO_Country",
                 options=list(gvis.editor="GDP", colorAxis="{colors:['#FFFFFF', '#0000FF']}"))
    
    
  })
}),


 options = list(height = 500)
)
} ## <- the function ends!!

## And now we call it

data1 <- read_csv('maps/data/data_normalized_092616.csv')
data2 <- read_csv('maps/data/CountryConversion.csv')
mapa(data1 = data1, data2 = data2)