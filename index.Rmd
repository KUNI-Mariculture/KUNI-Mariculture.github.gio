---
title: "Mariculture"
output:
  html_document:
    theme: united
    highlight: tango
    runtime: shiny
---

##Maping mariculture variables 2011

```{r, echo=FALSE, warning=FALSE}

setwd("~/KUNI/KUNI-Mariculture.github.io")

suppressPackageStartupMessages({
  library(readr)
  library(dplyr)
  library(tidyr)
  library(ggplot2)
  library(knitr)
  library(shiny)
  library(googleVis)

})

```

```{r echo = FALSE}
require(shiny)

mapa <- function(variable, FAO_Country, gTitle = "Mariculture 2011", var = "GDP"){
  require(shiny)
  
shinyApp(
  
  ui <- shinyUI(fluidPage(
  
  # Application title
  titlePanel(gTitle),
  
  # Show a plot of the generated distribution
  mainPanel(
    htmlOutput("gvis")
  )
)),


server <- shinyServer(function(input, output) {
  
  output$gvis=renderGvis({
    
    temp <- data.frame(data = variable, FAO_Country = FAO_Country) 
    # Plot countries
    
    gvisGeoChart(temp, "FAO_Country", "data", hovervar="FAO_Country",
                 options=list(gvis.editor=var, colorAxis="{colors:['#FFFFFF', '#0000FF']}"))
    
    
  })
}),


 options = list(height = 500)
)
} ## <- the function ends!!
```


```{r echo = FALSE, message=FALSE}

data1 <- read_csv('maps/data/data_normalized_092616.csv')
data2 <- read_csv('maps/data/CountryConversion.csv')

data3 <- data1 %>% 
            rename(FAO_Country=country) %>%        #rename match column FAO_Country
            left_join(                             #joining normalizaed data with conversion by country
              data2, 
              by = c("FAO_Country")) 

#gdp
data4 <- data3[!is.na(data3$gdp),]
mapa(variable = data4$gdp, FAO_Country = data4$FAO_Country, gTitle = "Mariculture 2011", var = "GDP")

#Q.balance
data4 <- data3[!is.na(data3$gdp),]
mapa(variable = data4$Q.balance, FAO_Country = data4$FAO_Country, gTitle = "Mariculture 2011", var = "Q.balance")

#UV.balance
data4 <- data3[!is.na(data3$UV.balance),]
mapa(variable = data4$UV.balance, FAO_Country = data4$FAO_Country, gTitle = "Mariculture 2011", var = "UV.balance")

#prod_ratio
data4 <- data3[!is.na(data3$prod_ratio),]
mapa(variable = data4$prod_ratio, FAO_Country = data4$FAO_Country, gTitle = "Mariculture 2011", var = "prod_ratio")

#energy_adequacy
data4 <- data3[!is.na(data3$energy_adequacy),]
mapa(variable = data4$energy_adequacy, FAO_Country = data4$FAO_Country, gTitle = "Mariculture 2011", var = "energy_adequacy")

#polyunsatFA_percentseafood
data4 <- data3[!is.na(data3$polyunsatFA_percentseafood),]
mapa(variable = data4$polyunsatFA_percentseafood, FAO_Country = data4$FAO_Country, gTitle = "Mariculture 2011", var = "polyunsatFA_percentseafood")

#calories_percentseafood
data4 <- data3[!is.na(data3$calories_percentseafood),]
mapa(variable = data4$calories_percentseafood, FAO_Country = data4$FAO_Country, gTitle = "Mariculture 2011", var = "calories_percentseafood")

#protein_percentseafood
data4 <- data3[!is.na(data3$protein_percentseafood),]
mapa(variable = data4$protein_percentseafood, FAO_Country = data4$FAO_Country, gTitle = "Mariculture 2011", var = "protein_percentseafood")

#vitamins_all
data4 <- data3[!is.na(data3$vitamins_all),]
mapa(variable = data4$vitamins_all, FAO_Country = data4$FAO_Country, gTitle = "Mariculture 2011", var = "vitamins_all")

#native
data4 <- data3[!is.na(data3$native),]
mapa(variable = data4$native, FAO_Country = data4$FAO_Country, gTitle = "Mariculture 2011", var = "native")

#fishmeal
data4 <- data3[!is.na(data3$fishmeal),]
mapa(variable = data4$fishmeal, FAO_Country = data4$FAO_Country, gTitle = "Mariculture 2011", var = "fishmeal")

#habitat
data4 <- data3[!is.na(data3$habitat),]
mapa(variable = data4$habitat, FAO_Country = data4$FAO_Country, gTitle = "Mariculture 2011", var = "habitat")

#spp_farmed
data4 <- data3[!is.na(data3$spp_farmed),]
mapa(variable = data4$spp_farmed, FAO_Country = data4$FAO_Country, gTitle = "Mariculture 2011", var = "spp_farmed")


```
